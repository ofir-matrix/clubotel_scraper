<!DOCTYPE html>
<html>
<head>
    <title>CORS Bypass Tester</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #e6ffe6; }
        .error { background-color: #ffe6e6; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>CORS Bypass Tester</h1>
    <div id="results"></div>

    <script>
    const url = 'https://www.clubhotels.co.il/BE_Results.aspx?lang=heb&hotel=1_1&rooms=1&ad1=2&ch1=3&inf1=0&in=2025-08-31&out=2025-09-04&_ga=2.78397907.694390100.1752303048-758168206.1752303047';
    
    async function testMethod(name, func) {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'result';
        document.getElementById('results').appendChild(resultDiv);

        try {
            console.log(`Testing ${name}...`);
            const result = await func();
            
            if (!result || result.length === 0) {
                throw new Error('Empty response received');
            }

            // Check if the response contains actual HTML content
            if (!result.includes('<!DOCTYPE') && !result.includes('<html')) {
                throw new Error('Response is not valid HTML');
            }

            resultDiv.classList.add('success');
            resultDiv.innerHTML = `
                <h3>✅ SUCCESS! ${name}</h3>
                <p>Length: ${result.length} chars</p>
                <p>First successful content preview:</p>
                <pre>${result.substring(0, 500).replace(/</g, '&lt;').replace(/>/g, '&gt;')}...</pre>
            `;
            console.log(`Success: ${name} - Length: ${result.length}`);
            console.log('Preview:', result.substring(0, 500));
        } catch (error) {
            resultDiv.classList.add('error');
            resultDiv.innerHTML = `
                <h3>❌ FAILED: ${name}</h3>
                <p>Error: ${error.message}</p>
            `;
            console.error(`Failed ${name}:`, error);
        }
    }

    // Test cases
    async function runTests() {
        console.log('=== ROUND 1 ===');
        document.getElementById('results').innerHTML += '<h2>=== ROUND 1 ===</h2>';

        // 1. AllOrigins
        await testMethod('AllOrigins', async () => {
            const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`, {
                headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const text = await response.text();
            
            if (!text || text.length === 0) {
                throw new Error('Empty response received from AllOrigins');
            }
            
            console.log('AllOrigins raw response:', text.substring(0, 200));
            return text;
        });

        // 2. CORS Anywhere
        await testMethod('CORS Anywhere', async () => {
            const response = await fetch(`https://cors-anywhere.herokuapp.com/${url}`);
            return await response.text();
        });

        // 3. Proxy with custom headers
        await testMethod('Custom Headers', async () => {
            const response = await fetch(url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                    'Origin': 'https://www.clubhotels.co.il'
                }
            });
            return await response.text();
        });

        // 4. No CORS mode
        await testMethod('No CORS Mode', async () => {
            const response = await fetch(url, {
                mode: 'no-cors'
            });
            return await response.text();
        });

        // 5. JSONP attempt (might not work with this endpoint)
        await testMethod('JSONP', async () => {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                const callbackName = 'jsonpCallback' + Math.round(Math.random() * 100000);
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.head.removeChild(script);
                    resolve(data);
                };
                script.src = `${url}&callback=${callbackName}`;
                script.onerror = reject;
                document.head.appendChild(script);
                setTimeout(() => reject(new Error('JSONP timeout')), 5000);
            });
        });

        console.log('=== ROUND 2 ===');
        document.getElementById('results').innerHTML += '<h2>=== ROUND 2 ===</h2>';

        // 6. YQL (alternative proxy)
        await testMethod('YQL', async () => {
            const yqlUrl = `https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D'${encodeURIComponent(url)}'&format=json`;
            const response = await fetch(yqlUrl);
            return await response.text();
        });

        // 7. Using XMLHttpRequest
        await testMethod('XMLHttpRequest', async () => {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.onload = () => resolve(xhr.responseText);
                xhr.onerror = () => reject(new Error('XHR failed'));
                xhr.send();
            });
        });

        // 8. Fetch with credentials
        await testMethod('Fetch with Credentials', async () => {
            const response = await fetch(url, {
                credentials: 'include'
            });
            return await response.text();
        });

        // 9. Another proxy service
        await testMethod('WebProxy', async () => {
            const response = await fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`);
            return await response.text();
        });

        // 10. Using a different proxy
        await testMethod('Another Proxy', async () => {
            const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
            return await response.text();
        });
    }

    // Run all tests
    runTests();
    </script>
</body>
</html>
